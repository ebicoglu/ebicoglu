name: Latest Tweets

on:
  schedule:
    - cron: "0 * * * *" # every hour
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-tweets:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Fetch tweets and update README
        run: |
          npm init -y > /dev/null
          npm install node-fetch@2 twitter-api-v2@1 > /dev/null

          cat << 'EOF' > update.js
          import { TwitterApi } from 'twitter-api-v2';
          import fs from 'fs';

          const client = new TwitterApi(process.env.TWITTER_BEARER_TOKEN);
          const username = 'alperebicoglu';
          const count = 3;

          const run = async () => {
            const user = await client.v2.userByUsername(username);
            const tweets = await client.v2.userTimeline(user.data.id, { max_results: count });

            const list = tweets.data.data
              .slice(0, count)
              .map(t => `- ${t.text.replace(/\n/g, " ")}`)
              .join('\n');

            let readme = fs.readFileSync("README
