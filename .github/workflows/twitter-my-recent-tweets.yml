name: Latest Tweets

on:
  schedule:
    - cron: "0 * * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-tweets:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Fetch tweets and update README
        run: |
          curl -s "https://rss2json.com/api.json?rss=https://nitter.net/alperebicoglu/rss" > tweets.json

          TWEETS=$(jq -r '.items[:3] | map("- " + .title) | join("\n")' tweets.json)

          START="<!-- TWEETS:START -->"
          END="<!-- TWEETS:END -->"
          BLOCK="$START"$'\n'"$TWEETS"$'\n'"$END"

          perl -0777 -pe "s/\Q$START\E[\\s\\S]*?\Q$END\E/$BLOCK/" README.md > README.new
          mv README.new README.md

      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update latest tweets"
